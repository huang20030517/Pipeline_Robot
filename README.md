# **Pipeline Robot 用户手册**

## **项目简介**

Pipeline Robot 是一个基于 ESP32-S3 的管道机器人项目，支持舵机控制、电机差速驱动、灯光调节、姿态检测以及 USB 通信。该项目采用 FreeRTOS，功能模块化，易于扩展。

---

## **功能列表**

1. **舵机控制**：调节角度范围 45°~115°。
2. **灯光调节**：通过 PWM 设置亮度（0%~100%）。
3. **电机驱动**：双轮差速控制前进、后退和转弯。
4. **姿态检测**：通过 MPU6050 传感器获取俯仰、横滚和偏航角度。
5. **USB 通信**：通过虚拟串口与上位机通信。
6. **编码器读取**：实时采集电机速度和累计位置。

---

## **硬件引脚**

| 模块 | GPIO 引脚 | 功能描述 |
| --- | --- | --- |
| 舵机控制 | GPIO9 | 调节舵机角度 |
| 灯光控制 | GPIO11 | 调节灯光亮度 |
| 电机0 控制 | GPIO1/2 | 方向/速度控制 |
| 电机1 控制 | GPIO7/8 | 方向/速度控制 |
| 摄像头切换 | GPIO10 | 控制摄像头方向 |
| MPU6050 I2C | GPIO33/34 | I2C 数据与时钟线 |

---

## **快速开始**

### **初始化**

```c
pwm_init();                // 初始化舵机、灯光、电机
encoder_init();            // 初始化编码器
i2c_sensor_mpu6050_init(); // 初始化 MPU6050
init_usb_device();         // 初始化 USB 通信
```

### **功能调用**

### 1. 舵机控制

```c
set_servo_angle(90); // 设置舵机转到 90°
```

### 2. 灯光调节

```c
set_light_brightness(75); // 设置亮度为 75%
```

### 3. 电机控制

```c
set_motor_direction(0.5, 1.0); // 前进并右转
```

### 4. 姿态检测

```c
complimentary_angle_t angle;
mpu6050_angle(&angle);
printf("Pitch: %.2f, Roll: %.2f, Yaw: %.2f\n", angle.pitch, angle.roll, angle.yaw);
```

### 5. USB 数据传输

```c
uint8_t data[] = "Hello, USB!";
usb_send_data(data, sizeof(data)); // 发送数据到 USB
```

---

## **常见问题**

| 问题 | 可能原因 | 解决方法 |
| --- | --- | --- |
| 舵机不转动 | GPIO 配置错误或供电不足 | 检查 GPIO 和供电连接 |
| 电机转动异常 | PWM 信号错误 | 检查 PWM 配置 |
| MPU6050 无数据 | I2C 地址错误或连线问题 | 检查传感器连接 |
| USB 无法通信 | CDC 初始化失败 | 检查 USB 配置和上位机 |


